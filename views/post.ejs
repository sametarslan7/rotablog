<%- include('partials/header') %>

<div class="post-wrapper">
    <!-- Blog Ä°Ã§eriÄŸi -->
    <article class="full-post">
        <div class="post-header">
            <span class="post-cat"><%= blog.category %></span>
            <h1><%= blog.title %></h1>
            <span class="post-date"><%= blog.date %></span>
            <!-- ... Ã¼stte baÅŸlÄ±k ve tarih var ... -->
                
                <!-- YENÄ°: SOSYAL MEDYA PAYLAÅIM BUTONLARI -->
                <div class="share-buttons">
                    <span class="share-label">Bu yazÄ±yÄ± sevdiklerinle paylaÅŸ:</span>
                    
                    <!-- WhatsApp -->
                    <a href="https://api.whatsapp.com/send?text=<%= blog.title %> - https://rotablog.com/blog/<%= blog.slug %>" target="_blank" class="share-btn whatsapp" title="WhatsApp'ta PaylaÅŸ">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                        WhatsApp
                    </a>

                    <!-- X (Twitter) -->
                    <a href="https://twitter.com/intent/tweet?text=<%= blog.title %>&url=https://rotablog.com/blog/<%= blog.slug %>" target="_blank" class="share-btn twitter" title="X'te PaylaÅŸ">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                        X
                    </a>

                    <!-- Facebook -->
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://rotablog.com/blog/<%= blog.slug %>" target="_blank" class="share-btn facebook" title="Facebook'ta PaylaÅŸ">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a8.68 8.68 0 0 1 1.141.195v3.325a8.623 8.623 0 0 0-.653-.036c-2.148 0-2.971.956-2.971 3.594v.376h3.428l-.581 3.667h-2.847v7.98c3.072-.789 5.245-3.525 5.245-6.753 0-3.837-3.141-6.974-6.974-6.974-3.837 0-6.974 3.137-6.974 6.974 0 3.23 2.175 5.966 5.247 6.753z"/></svg>
                        Facebook
                    </a>
                </div>
        </div>
        
        <img src="<%= blog.image %>" class="main-post-image" alt="<%= blog.title %>">
        
        <!-- AdSense YazÄ± Ä°Ã§i -->

        <!-- ... YukarÄ±da blog iÃ§eriÄŸi var ... -->
        
        <div class="post-content">
            <%- blog.content %>
        </div>

        <!-- YENÄ°: BEÄENÄ° ALANI -->
        <div class="like-section">
            <button id="likeBtn" class="like-button" onclick="likePost('<%= blog.slug %>')">
                â¤ï¸ <span id="likeText">Bu YazÄ±yÄ± BeÄŸen</span>
            </button>
            <span class="like-count"><strong id="likeCount"><%= blog.likes %></strong> kiÅŸi beÄŸendi</span>
        </div>

        <hr class="separator">
        <!-- ... YukarÄ±da iÃ§erik ve beÄŸeni butonu var ... -->

        <hr class="separator">

        <!-- YENÄ°: BENZER YAZILAR ALANI -->
        <% if (relatedPosts && relatedPosts.length > 0) { %>
        <div class="related-wrapper">
            <h3 class="related-title">BunlarÄ± da BeÄŸenebilirsiniz âœˆï¸</h3>
            <div class="related-grid">
                <% relatedPosts.forEach(post => { %>
                    <a href="/blog/<%= post.slug %>" class="related-card">
                        <div class="related-img">
                            <img src="<%= post.image %>" alt="<%= post.title %>">
                        </div>
                        <div class="related-info">
                            <h4><%= post.title %></h4>
                            <span class="read-more">Oku &rarr;</span>
                        </div>
                    </a>
                <% }) %>
            </div>
        </div>
        <% } %>

        <hr class="separator">

        <!-- ... AÅŸaÄŸÄ±da Yorumlar AlanÄ± BaÅŸlÄ±yor ... -->
        <div class="comments-wrapper" id="comments-section">
        <!-- YENÄ°: YORUMLAR ALANI -->
        <div class="comments-wrapper" id="comments-section">
            <h3>Yorumlar (<%= blog.comments.length %>)</h3>

            <!-- Yorum Listesi -->
            <div class="comments-list">
                <% if (blog.comments.length > 0) { %>
                    <% blog.comments.forEach(comment => { %>
                        <div class="comment-item">
                            <div class="comment-avatar"><%= comment.name.charAt(0).toUpperCase() %></div>
                            <div class="comment-body">
                                <strong><%= comment.name %></strong>
                                <span class="comment-date"><%= new Date(comment.date).toLocaleDateString('tr-TR') %></span>
                                <p><%= comment.text %></p>
                            </div>
                        </div>
                    <% }) %>
                <% } else { %>
                    <p class="no-comments">HenÃ¼z yorum yapÄ±lmamÄ±ÅŸ. Ä°lk yorumu sen yap! ğŸ‘‡</p>
                <% } %>
            </div>

            <!-- Yorum Yapma Formu -->
            <div class="comment-form">
                <h4>Yorum BÄ±rak</h4>
                <form action="/blog/<%= blog.slug %>/comment" method="POST">
                    <input type="text" name="name" placeholder="AdÄ±nÄ±z" required>
                    <textarea name="comment" rows="4" placeholder="Yorumunuzu buraya yazÄ±n..." required></textarea>
                    <button type="submit" class="btn-submit">GÃ¶nder</button>
                </form>
            </div>
        </div>

        <!-- ... AÅŸaÄŸÄ±da post-footer ve etiketler var ... -->

        <div class="post-footer">
            <h4>Etiketler:</h4>
            <div class="tags-cloud">
                <% blog.tags.forEach(tag => { %>
                    <a href="/?search=<%= tag %>" class="tag-link">#<%= tag %></a>
                <% }) %>
            </div>
        </div>
    </article>
</div>
<script>
    // Sayfa yÃ¼klendiÄŸinde kontrol et: Daha Ã¶nce beÄŸenmiÅŸ mi?
    const slug = "<%= blog.slug %>";
    const localKey = "liked_" + slug;
    const likeBtn = document.getElementById("likeBtn");
    const likeText = document.getElementById("likeText");

    if (localStorage.getItem(localKey)) {
        likeBtn.classList.add("liked");
        likeBtn.disabled = true;
        likeText.innerText = "BeÄŸendiniz";
    }

    // BeÄŸeni Butonuna TÄ±klanÄ±nca
    function likePost(slug) {
        // EÄŸer zaten beÄŸendiyse iÅŸlem yapma
        if (localStorage.getItem(localKey)) return;

        fetch('/api/blog/' + slug + '/like', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // SayÄ±yÄ± gÃ¼ncelle
                    document.getElementById("likeCount").innerText = data.newLikes;
                    
                    // Butonu pasif yap ve kaydet
                    likeBtn.classList.add("liked");
                    likeBtn.disabled = true;
                    likeText.innerText = "BeÄŸendiniz";
                    localStorage.setItem(localKey, "true");
                }
            })
            .catch(err => console.error("Hata:", err));
    }
</script>
<%- include('partials/footer') %>