<%- include('partials/header') %>

<div class="post-wrapper">
    <!-- Blog Ä°Ã§eriÄŸi -->
    <article class="full-post">
        <div class="post-header">
            <span class="post-cat"><%= blog.category %></span>
            <h1><%= blog.title %></h1>
            <span class="post-date"><%= blog.date %></span>
        </div>
        
        <img src="<%= blog.image %>" class="main-post-image" alt="<%= blog.title %>">
        
        <!-- AdSense YazÄ± Ä°Ã§i -->

        <!-- ... YukarÄ±da blog iÃ§eriÄŸi var ... -->
        
        <div class="post-content">
            <%- blog.content %>
        </div>

        <!-- YENÄ°: BEÄENÄ° ALANI -->
        <div class="like-section">
            <button id="likeBtn" class="like-button" onclick="likePost('<%= blog.slug %>')">
                â¤ï¸ <span id="likeText">Bu YazÄ±yÄ± BeÄŸen</span>
            </button>
            <span class="like-count"><strong id="likeCount"><%= blog.likes %></strong> kiÅŸi beÄŸendi</span>
        </div>

        <hr class="separator">

        <!-- YENÄ°: YORUMLAR ALANI -->
        <div class="comments-wrapper" id="comments-section">
            <h3>Yorumlar (<%= blog.comments.length %>)</h3>

            <!-- Yorum Listesi -->
            <div class="comments-list">
                <% if (blog.comments.length > 0) { %>
                    <% blog.comments.forEach(comment => { %>
                        <div class="comment-item">
                            <div class="comment-avatar"><%= comment.name.charAt(0).toUpperCase() %></div>
                            <div class="comment-body">
                                <strong><%= comment.name %></strong>
                                <span class="comment-date"><%= new Date(comment.date).toLocaleDateString('tr-TR') %></span>
                                <p><%= comment.text %></p>
                            </div>
                        </div>
                    <% }) %>
                <% } else { %>
                    <p class="no-comments">HenÃ¼z yorum yapÄ±lmamÄ±ÅŸ. Ä°lk yorumu sen yap! ğŸ‘‡</p>
                <% } %>
            </div>

            <!-- Yorum Yapma Formu -->
            <div class="comment-form">
                <h4>Yorum BÄ±rak</h4>
                <form action="/blog/<%= blog.slug %>/comment" method="POST">
                    <input type="text" name="name" placeholder="AdÄ±nÄ±z" required>
                    <textarea name="comment" rows="4" placeholder="Yorumunuzu buraya yazÄ±n..." required></textarea>
                    <button type="submit" class="btn-submit">GÃ¶nder</button>
                </form>
            </div>
        </div>

        <!-- ... AÅŸaÄŸÄ±da post-footer ve etiketler var ... -->

        <div class="post-footer">
            <h4>Etiketler:</h4>
            <div class="tags-cloud">
                <% blog.tags.forEach(tag => { %>
                    <a href="/?search=<%= tag %>" class="tag-link">#<%= tag %></a>
                <% }) %>
            </div>
        </div>
    </article>
</div>
<script>
    // Sayfa yÃ¼klendiÄŸinde kontrol et: Daha Ã¶nce beÄŸenmiÅŸ mi?
    const slug = "<%= blog.slug %>";
    const localKey = "liked_" + slug;
    const likeBtn = document.getElementById("likeBtn");
    const likeText = document.getElementById("likeText");

    if (localStorage.getItem(localKey)) {
        likeBtn.classList.add("liked");
        likeBtn.disabled = true;
        likeText.innerText = "BeÄŸendiniz";
    }

    // BeÄŸeni Butonuna TÄ±klanÄ±nca
    function likePost(slug) {
        // EÄŸer zaten beÄŸendiyse iÅŸlem yapma
        if (localStorage.getItem(localKey)) return;

        fetch('/api/blog/' + slug + '/like', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // SayÄ±yÄ± gÃ¼ncelle
                    document.getElementById("likeCount").innerText = data.newLikes;
                    
                    // Butonu pasif yap ve kaydet
                    likeBtn.classList.add("liked");
                    likeBtn.disabled = true;
                    likeText.innerText = "BeÄŸendiniz";
                    localStorage.setItem(localKey, "true");
                }
            })
            .catch(err => console.error("Hata:", err));
    }
</script>
<%- include('partials/footer') %>